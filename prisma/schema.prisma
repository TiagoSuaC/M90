generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String   @id @default(cuid())
  name         String
  email        String   @unique
  passwordHash String
  role         Role     @default(NURSING)
  clinicId     String?
  clinic       Clinic?  @relation(fields: [clinicId], references: [id])
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

enum Role {
  ADMIN
  NURSING
  ENDOCRINO
  NUTRI
}

model Clinic {
  id        String    @id @default(cuid())
  name      String
  city      String
  users     User[]
  patients  Patient[]
  createdAt DateTime  @default(now())
}

model PackageTemplate {
  id                        String    @id @default(cuid())
  name                      String    @unique
  durationWeeks             Int       @default(12)
  tirzepatidaTotalMg        Decimal   @default(90) @db.Decimal(6, 2)
  consultasEndocrinoTotal   Int       @default(3)
  consultasNutriTotal       Int       @default(2)
  active                    Boolean   @default(true)
  patients                  Patient[]
  createdAt                 DateTime  @default(now())
}

model Patient {
  id                String              @id @default(cuid())
  fullName          String
  clinicId          String
  clinic            Clinic              @relation(fields: [clinicId], references: [id])
  packageTemplateId String
  packageTemplate   PackageTemplate     @relation(fields: [packageTemplateId], references: [id])
  startDate         DateTime            @db.Date
  status            PatientStatus       @default(ACTIVE)
  notes             String?
  createdById       String
  applications      Application[]
  indications       MedicalIndication[]
  consultations     Consultation[]
  measurements      BodyMeasurement[]
  stockAdjustments  StockAdjustment[]
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
}

enum PatientStatus {
  ACTIVE
  COMPLETED
  PAUSED
  CANCELLED
}

model Application {
  id              String   @id @default(cuid())
  patientId       String
  patient         Patient  @relation(fields: [patientId], references: [id])
  applicationDate DateTime @db.Date
  doseMg          Decimal  @db.Decimal(5, 2)
  notes           String?
  administeredBy  String
  createdAt       DateTime @default(now())
}

model MedicalIndication {
  id                   String   @id @default(cuid())
  patientId            String
  patient              Patient  @relation(fields: [patientId], references: [id])
  startDate            DateTime @db.Date
  doseMgPerApplication Decimal  @db.Decimal(5, 2)
  frequencyDays        Int      @default(7)
  notes                String?
  createdById          String
  createdAt            DateTime @default(now())
}

model Consultation {
  id               String           @id @default(cuid())
  patientId        String
  patient          Patient          @relation(fields: [patientId], references: [id])
  type             ConsultationType
  consultationDate DateTime         @db.Date
  professional     String
  notes            String?
  countsInPackage  Boolean          @default(true)
  createdById      String
  createdAt        DateTime         @default(now())
}

enum ConsultationType {
  ENDOCRINO
  NUTRI
}

model BodyMeasurement {
  id              String   @id @default(cuid())
  patientId       String
  patient         Patient  @relation(fields: [patientId], references: [id])
  measurementDate DateTime @db.Date
  weightKg        Decimal  @db.Decimal(5, 2)
  fatPercentage   Decimal? @db.Decimal(4, 1)
  leanMassKg      Decimal? @db.Decimal(5, 2)
  notes           String?
  createdById     String
  createdAt       DateTime @default(now())
}

model StockAdjustment {
  id           String   @id @default(cuid())
  patientId    String
  patient      Patient  @relation(fields: [patientId], references: [id])
  adjustmentMg Decimal  @db.Decimal(6, 2)
  reason       String
  createdById  String
  createdAt    DateTime @default(now())
}
